# OpenSMTPD Remote Code Execution Vulnerability (CVE-2020-7247)

OpenSMTPD é um programa de serviço smtp para sistemas operacionais unix (BSD, MacOS, GNU/Linux), seguindo o protocolo SMTP RFC 5321. O OpenSMTPD foi originalmente desenvolvido para o sistema operacional OpenBSD e faz parte do projeto OpenBSD. Devido às suas propriedades de código aberto, Distribuído para outras plataformas unix. De acordo com a licença ISC, o software é gratuito para todos usarem e reutilizarem.

`CVE-2020-7247` é causado pela verificação frouxa do OpenSMTPD do remetente/destinatário no processo de implementação do RFC 5321.

Em 29 de janeiro de 2020, o grupo OpenSMTPD enviou oficialmente uma correção para o `CVE-2020-7247` no repositório GitHub. Após o reparo, a versão correspondente é `OpenSMTPD 6.6.2p1`.

**Referência:**

- https://www.qualys.com/2020/01/28/cve-2020-7247/lpe-rce-opensmtpd.txt
- https://www.exploit-db.com/exploits/47984
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7247
- https://www.anquanke.com/post/id/197689

## Iniciar aplicativo de vulnerabilidade

Inicie um OpenSMTPD vulnerável através do seguinte comando:

```
docker-compose up -d
```

Depois que o servidor SMTPD for iniciado, conecte-se à porta 8825 e obtenha o resultado (`44dadcc5a6eb` é o ID do contêiner):

```
$ nc <your-ip> 8825 -v
220 44dadcc5a6eb ESMTP OpenSMTPD
```

## Reprodução de vulnerabilidade

Use [Exploit-DB](https://www.exploit-db.com/exploits/47984) para obter um shell reverso:

```
python3 poc.py your-ip 8825 <command>
```

![image](https://github.com/CatAndCoffee/vulhub/blob/CVE-2020-7247/OpenSMTPD/CVE-2020-7247/image-20210415233036042.png)
