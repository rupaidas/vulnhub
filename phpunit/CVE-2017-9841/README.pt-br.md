# PHPUnit Remote Code Execution (CVE-2017-9841)

PHPUnit é uma estrutura de teste orientada ao programador para PHP.

`Util/PHP/eval-stdin.php` no PHPUnit antes de 4.8.28 e 5.x antes de 5.6.3 permite que atacantes remotos executem código PHP arbitrário via dados HTTP POST começando com uma substring `<?php`, como demonstrado por um ataque em um site com uma pasta /vendor exposta, ou seja, acesso externo ao URI `/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php`.

O código vulnerável do `Util/PHP/eval-stdin.php`:

```php
eval('?>'.file_get_contents('php://input'));
```

Links de referência:

- http://web.archive.org/web/20170701212357/http://phpunit.vulnbusters.com/
- https://www.ovh.com/blog/cve-2017-9841-what-is-it-and-how-do-we-protect-our-customers/

## Ambiente vulnerável

Execute o seguinte comando para iniciar um servidor web Apache, que contém o PHPUnit 5.6.2 no diretório web.

```
docker-compose up -d
```

Abra o `http://your-ip:8080` para ver a página de índice que o servidor Web está executando.

## Explorando

Envie uma solicitação para `http://your-ip:8080/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php`, que contém qualquer código PHP dentro do corpo da requisição:

![](1.png)
